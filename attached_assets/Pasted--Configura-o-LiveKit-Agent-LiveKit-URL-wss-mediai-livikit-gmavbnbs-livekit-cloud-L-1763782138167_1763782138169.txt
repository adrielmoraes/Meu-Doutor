
‚úÖ Configura√ß√£o LiveKit Agent:
  ‚Ä¢ LiveKit URL: wss://mediai-livikit-gmavbnbs.livekit.cloud
  ‚Ä¢ LiveKit API Key: APIrYvWHxL...
  ‚Ä¢ Gemini API: ‚úÖ Configurado (100% Gemini powered)
  ‚Ä¢ Avatar Providers Dispon√≠veis:
    - Tavus: ‚ö™ N√£o configurado
      API Key: ‚úó
      Replica ID: ‚úì
      Persona ID: ‚úì
    - Beyond Presence (BEY): üé≠ CONFIGURADO
      Avatar ID: 694c83e2-8895-4a98-bd16-56332ca3f449
  ‚Ä¢ Avatar Ativo: Definido no Admin Panel (banco de dados)
  ‚Ä¢ Database: ‚úÖ Configurado

============================================================
üé≠ Iniciando MediAI Agent...
   üì° Aguardando pacientes na sala LiveKit...
   üé• O avatar Tavus aparecer√° automaticamente quando
   üè• um paciente iniciar uma consulta!
   üß† 100% Gemini API (STT + LLM + TTS)
============================================================

{"level": "INFO", "name": "livekit.agents", "message": "starting worker", "version": "1.3.3", "rtc-version": "1.0.19", "timestamp": "2025-11-22T03:26:20.450552+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "preloading plugins", "packages": ["livekit.plugins.tavus", "livekit.plugins.bey", "livekit.plugins.google", "av"], "timestamp": "2025-11-22T03:26:20.450744+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "initializing process", "pid": 28573, "timestamp": "2025-11-22T03:26:23.820242+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "initializing process", "pid": 28575, "timestamp": "2025-11-22T03:26:23.829500+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "initializing process", "pid": 28577, "timestamp": "2025-11-22T03:26:23.837824+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "initializing process", "pid": 28579, "timestamp": "2025-11-22T03:26:23.889216+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "process initialized", "pid": 28573, "elapsed_time": 0.67, "timestamp": "2025-11-22T03:26:24.490838+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "process initialized", "pid": 28579, "elapsed_time": 0.67, "timestamp": "2025-11-22T03:26:24.561034+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "process initialized", "pid": 28575, "elapsed_time": 0.85, "timestamp": "2025-11-22T03:26:24.683266+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "process initialized", "pid": 28577, "elapsed_time": 0.9, "timestamp": "2025-11-22T03:26:24.735659+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "registered worker", "agent_name": "", "id": "AW_mt53o8QXxBXa", "url": "wss://mediai-livikit-gmavbnbs.livekit.cloud", "region": "US East B", "protocol": 16, "timestamp": "2025-11-22T03:26:24.833809+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "received job request", "job_id": "AJ_ULpoyGME9g26", "dispatch_id": "AD_qxicmY9SoynK", "room": "mediai-consultation-c8b5a464-aa1b-4a33-8eaf-306a67f068d2", "room_id": "RM_adomh3RVZjsY", "agent_name": "", "resuming": false, "enable_recording": false, "timestamp": "2025-11-22T03:26:44.028358+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "initializing process", "pid": 28598, "timestamp": "2025-11-22T03:26:44.058858+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üéØ Starting agent for patient: c8b5a464-aa1b-4a33-8eaf-306a67f068d2", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:44.342266+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[Metrics] üìä Iniciado coletor de m√©tricas para sess√£o mediai-consultation-c8b5a464-aa1b-4a33-8eaf-306a67f068d2", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:44.342419+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üìã Loading patient context...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:44.342463+00:00"}
{"level": "INFO", "name": "livekit.agents", "message": "process initialized", "pid": 28598, "elapsed_time": 0.36, "timestamp": "2025-11-22T03:26:44.417587+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] ‚úÖ Patient context loaded (651 chars)", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.226166+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] ü§ñ Creating Gemini Live API model...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.226285+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üéôÔ∏è Using Gemini model: gemini-2.5-flash-lite", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.226339+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üéôÔ∏è Creating agent session with Gemini Live API...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.226375+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üè• Starting medical consultation session...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.227395+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üõ†Ô∏è Function tools ser√£o executados automaticamente pelo LiveKit", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.227451+00:00"}
{"level": "WARNING", "name": "google_genai._api_client", "message": "Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY.", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.229951+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] ‚è≥ Waiting for avatar to be visible and audio/video to sync...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.282588+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] ‚úÖ Session started successfully!", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.283056+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üìπ Using periodic vision analysis (every 20s) instead of continuous streaming", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:47.283091+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] Avatar provider configured: bey", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:48.380766+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üé≠ Avatar provider selected: bey", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:48.380947+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üé≠ Initializing Beyond Presence (BEY) avatar...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:48.381001+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üé• Starting BEY avatar...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:48.381059+00:00"}
{"level": "ERROR", "name": "livekit.plugins.google", "message": "Gemini Realtime API error: received 1007 (invalid frame payload data) Requested voice api_name 'Erinome' is not available for model models/gemini-2.0-flash-live-001; then sent 1007 (invalid frame payload data) Requested voice api_name 'Erinome' is not available for model models/gemini-2.0-flash-live-001\nTraceback (most recent call last):\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/livekit/plugins/google/realtime/realtime_api.py\", line 667, in _main_task\n    async with self._client.aio.live.connect(\n  File \"/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/contextlib.py\", line 210, in __aenter__\n    return await anext(self.gen)\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/live.py\", line 1085, in connect\n    raw_response = await ws.recv(decode=False)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/websockets/asyncio/connection.py\", line 322, in recv\n    raise self.protocol.close_exc from self.recv_exc\nwebsockets.exceptions.ConnectionClosedError: received 1007 (invalid frame payload data) Requested voice api_name 'Erinome' is not available for model models/gemini-2.0-flash-live-001; then sent 1007 (invalid frame payload data) Requested voice api_name 'Erinome' is not available for model models/gemini-2.0-flash-live-001", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:48.699279+00:00"}
{"level": "ERROR", "name": "livekit.agents", "message": "AgentSession is closing due to unrecoverable error\nTraceback (most recent call last):\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/livekit/plugins/google/realtime/realtime_api.py\", line 667, in _main_task\n    async with self._client.aio.live.connect(\n  File \"/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/contextlib.py\", line 210, in __aenter__\n    return await anext(self.gen)\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/live.py\", line 1085, in connect\n    raw_response = await ws.recv(decode=False)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/websockets/asyncio/connection.py\", line 322, in recv\n    raise self.protocol.close_exc from self.recv_exc\nwebsockets.exceptions.ConnectionClosedError: received 1007 (invalid frame payload data) Requested voice api_name 'Erinome' is not available for model models/gemini-2.0-flash-live-001; then sent 1007 (invalid frame payload data) Requested voice api_name 'Erinome' is not available for model models/gemini-2.0-flash-live-001", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:48.709118+00:00"}
{"level": "ERROR", "name": "livekit.plugins.google", "message": "Error in _main_task\nTraceback (most recent call last):\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/livekit/plugins/google/realtime/realtime_api.py\", line 667, in _main_task\n    async with self._client.aio.live.connect(\n  File \"/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/contextlib.py\", line 210, in __aenter__\n    return await anext(self.gen)\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/live.py\", line 1085, in connect\n    raw_response = await ws.recv(decode=False)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/websockets/asyncio/connection.py\", line 322, in recv\n    raise self.protocol.close_exc from self.recv_exc\nwebsockets.exceptions.ConnectionClosedError: received 1007 (invalid frame payload data) Requested voice api_name 'Erinome' is not available for model models/gemini-2.0-flash-live-001; then sent 1007 (invalid frame payload data) Requested voice api_name 'Erinome' is not available for model models/gemini-2.0-flash-live-001\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/livekit/agents/utils/log.py\", line 16, in async_fn_logs\n    return await fn(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/livekit/plugins/google/realtime/realtime_api.py\", line 717, in _main_task\n    raise APIConnectionError(message=\"Failed to connect to Gemini Live\") from e\nlivekit.agents._exceptions.APIConnectionError: Failed to connect to Gemini Live (body=None, retryable=True)", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:48.709847+00:00"}
{"level": "WARNING", "name": "livekit.agents", "message": "resume_false_interruption is enabled, but the audio output does not support pause, ignored", "audio_output": "DataStreamIO", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:51.561378+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] ‚úÖ Beyond Presence avatar started successfully!", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:51.561532+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üëÅÔ∏è Vision loop ready (will activate when patient speaks)...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:52.284425+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[MediAI] üé§ Generating initial greeting in PT-BR...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:52.284613+00:00"}
{"level": "ERROR", "name": "livekit.agents", "message": "Error in _traceable_on_enter\nTraceback (most recent call last):\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/livekit/agents/utils/log.py\", line 16, in async_fn_logs\n    return await fn(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/livekit/agents/voice/agent_activity.py\", line 456, in _traceable_on_enter\n    await self._agent.on_enter()\n  File \"/home/runner/workspace/livekit-agent/agent.py\", line 1059, in on_enter\n    await self._agent_session.generate_reply(instructions=initial_greeting)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/livekit/agents/voice/agent_session.py\", line 938, in generate_reply\n    raise RuntimeError(\"AgentSession is closing, cannot use generate_reply()\")\nRuntimeError: AgentSession is closing, cannot use generate_reply()", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:52.284713+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[Metrics] üîÑ Iniciando envio peri√≥dico de m√©tricas a cada 60s...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:52.286788+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[Vision] üí§ Vision loop waiting for patient to start speaking...", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:26:57.287257+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[Metrics] ‚úÖ M√©tricas DELTA enviadas com sucesso!", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:27:53.555233+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[Metrics] Delta tokens: +54", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:27:53.555274+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[Metrics] Total acumulado: 54", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:27:53.555307+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[Metrics] Tempo ativo: 67s", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:27:53.555334+00:00"}
{"level": "INFO", "name": "mediai-avatar", "message": "[Metrics] Custo delta: R$ 0.00", "pid": 28573, "job_id": "AJ_ULpoyGME9g26", "room_id": "RM_adomh3RVZjsY", "timestamp": "2025-11-22T03:27:53.555363+00:00"}